<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>设置</title>
    <link rel="stylesheet" href="./vendor/simple-line-icons/css/simple-line-icons.css">
    <link rel="stylesheet" href="./vendor/font-awesome/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body class="sidebar-fixed header-fixed">
<div class="page-wrapper">
    <nav class="navbar page-header">
        <a href="#" class="btn btn-link sidebar-mobile-toggle d-md-none mr-auto">
            <i class="fa fa-bars"></i>
        </a>
        <a href="#" class="btn btn-link sidebar-toggle d-md-down-none">
            <i class="fa fa-bars"></i>
        </a>

    </nav>

    <div class="main-container">
        <div class="sidebar">
            <nav class="sidebar-nav">
                <ul class="nav">
                    <li class="nav-title">导航</li>

                    <li class="nav-item">
                        <a href="index.html" class="nav-link active">
                            <i class="icon icon-speedometer"></i> 主页
                        </a>
                    </li>

                    <li class="nav-item nav-dropdown">
                        <a href="#" class="nav-link nav-dropdown-toggle">
                            <i class="icon icon-graph"></i> 卫生评分 <i class="fa fa-caret-left"></i>
                        </a>

                        <ul class="nav-dropdown-items">
                            <li class="nav-item">
                                <a href="myDormitory.html" class="nav-link">
                                    <i class="icon icon-graph"></i> 我的宿舍
                                </a>
                            </li>

                            <li class="nav-item">
                                <a href="myMajor.html" class="nav-link">
                                    <i class="icon icon-graph"></i> 我们专业
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item nav-dropdown">
                        <a href="#" class="nav-link nav-dropdown-toggle">
                            <i class="icon icon-energy"></i> 公物报修 <i class="fa fa-caret-left"></i>
                        </a>

                        <ul class="nav-dropdown-items">
                            <li class="nav-item">
                                <a href="initiateRepair.html" class="nav-link">
                                    <i class="icon icon-energy"></i> 发起报修
                                </a>
                            </li>

                            <li class="nav-item">
                                <a href="handling.html" class="nav-link">
                                    <i class="icon icon-energy"></i> 处理中
                                </a>
                            </li>

                            <li class="nav-item">
                                <a href="evaluate.html" class="nav-link">
                                    <i class="icon icon-energy"></i> 待评价
                                </a>
                            </li>

                            <li class="nav-item">
                                <a href="history.html" class="nav-link">
                                    <i class="icon icon-energy"></i> 已完成
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item nav-dropdown open">
                        <a href="#" class="nav-link nav-dropdown-toggle">
                            <i class="icon icon-target"></i> 我的 <i class="fa fa-caret-left"></i>
                        </a>

                        <ul class="nav-dropdown-items">
                            <li class="nav-item">
                                <a href="settings.html" class="nav-link">
                                    <i class="icon icon-target"></i> 个人资料
                                </a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item">
                        <a href="#" onclick="location.href='/logout'" class="nav-link">
                            <i class="icon icon-puzzle"></i> 退出登录
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="content" id="app">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-10">
                        <form action="/user/saveUser" method="post" id="userForm">
                            <div class="card">
                                <div class="card-header bg-light">
                                    个人资料
                                </div>

                                <div class="card-body">
                                    <div class="row mb-5">
                                        <div class="col-md-8">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <input type="hidden" name="id" :value="list.id">
                                                        <label class="form-control-label">昵称</label>
                                                        <input class="form-control" name="nickName" :value="list.nickName">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="form-control-label">手机号</label>
                                                        <input class="form-control" name="phone" :value="list.phone">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="form-control-label">邮箱</label>
                                                        <input class="form-control" name="email" :value="list.email">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="form-control-label">学生信息</label>
                                                        <span v-if="list.bindId==null" class="form-control">未绑定请在下方绑定信息</span>
                                                        <span v-if="list.bindId!=null" class="form-control">已绑定</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row" v-if="list.bindId==null">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="form-control-label">学号</label>
                                                        <input class="form-control" name="stuNum" >
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="form-control-label">密码</label>
                                                        <input type="password" class="form-control" name="stuPwd" >
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <hr>

                                    <div class="row mt-5">
                                        <div class="col-md-4 mb-4">
                                            <div>密码修改</div>
                                            <div class="text-muted small">如果不改密码，空着就好</div>
                                        </div>

                                        <div class="col-md-8">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="form-control-label">新密码</label>
                                                        <input id="pwd1" type="password" name="password" class="form-control" >
                                                    </div>
                                                </div>

                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="form-control-label">再次确认</label>
                                                        <input id="pwd2" type="password" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="card-footer bg-light text-right">
                                    <button type="button" @click="saveUser()" class="btn btn-primary">保存</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="./vendor/jquery/jquery.min.js"></script>
<script src="./vendor/popper.js/popper.min.js"></script>
<script src="./vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="./vendor/chart.js/chart.min.js"></script>
<script src="./js/carbon.js"></script>
<script src="./js/demo.js"></script>
<script src="js/vue.js"></script>
<script src="js/jquery-form.js"></script>
<script src="js/layer.js"></script>
<SCRIPT>
    var vm = new Vue({
        el: "#app",
        data: {
            list: ''
        },
        mounted: function () {
            this.getmodel();
        },
        methods: {
            getmodel: function (page) {
                $.ajax({
                    url: "/user/getUser",
                    type: "GET",
                    data: {},
                    dataType: "json",
                    success: function (data) {
                        vm.list = data
                    }
                });

            },
            saveUser:function () {
                    if ($("#pwd1").val()!=$("#pwd2").val()){
                        layer.msg("两次密码不一致!!")
                        return;
                    }
                    $("#userForm").ajaxSubmit({
                        dataType: "json",
                        async: false,
                        beforeSubmit: function (formData, jqForm, options) {
                            tipIndex = parent.layer.load(1, {
                                shade: 0.01
                            });
                        },
                        success: function (ret) {
                            if (ret.state == "ok") {
                                parent.layer.msg(ret.msg, {
                                    time: 3000,
                                })

                            } else {
                                layer.msg(ret.msg, {
                                    time: 3000,
                                })
                            }

                        },
                        complete: function (ret) {
                            parent.layer.close(tipIndex);
                        }
                    })


            }
        }
    });

</SCRIPT>
</body>
</html>
